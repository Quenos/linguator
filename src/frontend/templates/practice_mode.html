<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Practice Mode - Linguator</title>
    <!-- Removed HTMX script -->
    <!-- Basic Styling (Optional) -->
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #practice-area { margin-top: 20px; border: 1px solid #ccc; padding: 15px; min-height: 150px; }
        #flashcard { padding: 10px; border: 1px dashed #eee; margin-top: 10px; }
    </style>
</head>
<body>

<h1>Practice Mode</h1>

<!-- Button to start the practice session -->
<button id="start-practice-btn">
    Start Practice (10 words)
</button>

<!-- Area where the practice questions/feedback will be loaded -->
<div id="practice-area">
    <p>Click "Start Practice" to begin.</p>
</div>

<script>
    // Store the fetched word pairs for the session
    let currentPracticePairs = [];
    let currentQuestionIndex = -1; // Initialize to -1, will be 0 for the first question
    let currentWordPair = null; // Store the currently displayed word pair

    const startButton = document.getElementById('start-practice-btn');
    const practiceArea = document.getElementById('practice-area');

    startButton.addEventListener('click', async () => {
        console.log('Start Practice clicked');
        practiceArea.innerHTML = '<p>Loading questions...</p>'; // Provide immediate feedback
        try {
            const response = await fetch('/word-pairs/?limit=10'); // Fetch 10 pairs
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            currentPracticePairs = await response.json(); // Store the pairs
            console.log('Fetched pairs:', currentPracticePairs);

            if (currentPracticePairs && currentPracticePairs.length > 0) {
                currentQuestionIndex = 0; // Set index to the first question
                displayQuestion(currentQuestionIndex);
            } else {
                practiceArea.innerHTML = '<p>No word pairs found to practice.</p>';
            }
        } catch (error) {
            console.error('Error fetching practice pairs:', error);
            practiceArea.innerHTML = '<p>Error loading questions. Please try again.</p>';
        }
    });

    function displayQuestion(index) {
        if (index < 0 || index >= currentPracticePairs.length) {
            practiceArea.innerHTML = '<p>Invalid question index.</p>'; // Should not happen in normal flow
            return;
        }

        currentWordPair = currentPracticePairs[index]; // Store current pair
        // Generate HTML for the flashcard (only the source word initially)
        practiceArea.innerHTML = `
            <div id="flashcard">
                <h2>Flashcard (${index + 1} / ${currentPracticePairs.length})</h2>
                <p><strong>Source Word:</strong> ${escapeHTML(currentWordPair.source_word)}</p>
                <div id="answer-area">
                    <!-- Answer will be revealed here -->
                </div>
                <div id="feedback-area">
                     <button id="show-answer-btn">Show Answer</button>
                </div>
                <!-- Placeholder for navigation (Ticket 4) -->
                <!-- <button>Next</button> -->
            </div>
        `;
        console.log(`Displayed question ${index + 1}:`, currentWordPair);

        // Add event listener to the new button
        document.getElementById('show-answer-btn').addEventListener('click', revealAnswer);
    }

    function revealAnswer() {
        if (!currentWordPair) return; // Should not happen

        const answerArea = document.getElementById('answer-area');
        const feedbackArea = document.getElementById('feedback-area');

        // Display the target word
        answerArea.innerHTML = `<p><strong>Target Word:</strong> ${escapeHTML(currentWordPair.target_word)}</p>`;

        // Replace "Show Answer" with "Correct" / "Incorrect" buttons
        feedbackArea.innerHTML = `
            <p>Did you know the answer?</p>
            <button id="correct-btn" style="background-color: #28a745; color: white; margin-right: 5px;">Correct</button>
            <button id="incorrect-btn" style="background-color: #dc3545; color: white;">Incorrect</button>
        `;

        // Add event listeners to feedback buttons
        document.getElementById('correct-btn').addEventListener('click', () => handleFeedback(true));
        document.getElementById('incorrect-btn').addEventListener('click', () => handleFeedback(false));
    }

    function handleFeedback(isCorrect) {
        console.log(`User feedback recorded: ${isCorrect ? 'Correct' : 'Incorrect'} for word pair ID: ${currentWordPair._id}`); // Placeholder for recording result (Epic 4, Ticket 2)

        const flashcardDiv = document.getElementById('flashcard');
        const feedbackArea = document.getElementById('feedback-area');

        // Provide visual feedback
        flashcardDiv.style.border = isCorrect ? '2px solid green' : '2px solid red';
        feedbackArea.innerHTML = `<p style="font-weight: bold; color: ${isCorrect ? 'green' : 'red'};">Marked as ${isCorrect ? 'Correct' : 'Incorrect'}.</p>`;

        // TODO: Add a "Next" button here as part of Ticket 4 logic
        // Example: feedbackArea.innerHTML += '<button id="next-btn">Next</button>';
        //          document.getElementById('next-btn').addEventListener('click', goToNextQuestion);

    }

    // Basic HTML escaping function to prevent XSS
    function escapeHTML(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

</script>

</body>
</html> 